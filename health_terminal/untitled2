import tensorflow as tf
import numpy as np
import SimpleHTTPServer
import BaseHTTPServer
import SocketServer

# Data sets
TRAINING = "data_nace_training.csv"
#TRAINING = "iris_training.csv"
#TEST = "iris_test.csv"
TEST = "data_nace_test.csv"

# Load datasets.
#target_dtype, takes the numpy datatype of the dataset's target value.

training_set = tf.contrib.learn.datasets.base.load_csv(filename=TRAINING, target_dtype=np.int)
test_set = tf.contrib.learn.datasets.base.load_csv(filename=TEST, target_dtype=np.int)

x_train, x_test, y_train, y_test = training_set.data, test_set.data, \
  training_set.target, test_set.target

#Deep Neural Network Classifier
# Build 3 layer DNN with 10, 20, 10 units respectively.
#classifier = tf.contrib.learn.DNNClassifier(hidden_units=[10, 20, 10], n_classes=3)
classifier = tf.contrib.learn.DNNClassifier(hidden_units=[10,  20, 10], n_classes=27)

# Fit model.
#classifier.fit(x=x_train, y=y_train, steps=200)
classifier.fit(x=x_train, y=y_train, steps=200)


#enter in values
a = []
#for x in xrange(0,8):
#    a.append(raw_input("Enter Data: "))

index_page = """
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>GFW_ML</title>
</head>
<body>
	
<h1>Customer Health Status</h1>
	
<p>Select a value for one of the text labels below:</p>

	
  	<form id="ML-form" action="index.py" method="post">

	<ul>
		<li><label for="name">Operational Efficiency:</label> <input type="text" name="name" id="name" value="" /></li>
		<li><label for="email">Adoption Score:</label> <input type="text" name="email" id="email" value="" /></li>
		<li><label for="pwd">Renewal Risk:</label> <input type="password" name="pwd" id="pwd" value="" /></li>
		<li><label for="pwd">Referencable:</label> <input type="password" name="pwd" id="pwd" value="" /></li>
		<li><label for="pwd">Transformation Agenda:</label> <input type="password" name="pwd" id="pwd" value="" /></li>
		<li><label for="pwd">Senior Sponsorship:</label> <input type="password" name="pwd" id="pwd" value="" /></li>
		<li><label for="pwd">Relationships:</label> <input type="password" name="pwd" id="pwd" value="" /></li>
		<li><label for="pwd">Partner Services:</label> <input type="password" name="pwd" id="pwd" value="" /></li>
	</ul>
    
  
    <ul>
	  	<li>
	  	<label for="OEfficiency">Operational Efficiency:</label>
	  	<select name="OEfficiency" id="OEfficiency">
	    <option value="">Select a value</option>
	    <option value="one">1</option>
	    <option value="zero">0</option>
	    <option value="nOne">-1</option>
	    <option value="nTwo">None</option>
	  	</select>
	  	</li><br>

	  	<li>
	  	<label for="AScore">Adoption Score:</label>
	  	<select name="AScore" id="AScore">
	    <option value="">Select a value</option>
	    <option value="one">1</option>
	    <option value="zero">0</option>
	    <option value="nOne">-1</option>
	    <option value="nTwo">None</option>
	  	</select>
	  	</li><br>

	  	<li>
	  	<label for="RRisk">Renewal Risk:</label>
	  	<select name="RRisk" id="RRisk">
	    <option value="">Select a value</option>
	    <option value="one">1</option>
	    <option value="zero">0</option>
	    <option value="nOne">-1</option>
	    <option value="nTwo">None</option>
	  	</select>
	  	</li><br>

	  	<li>
	  	<label for="OEfficiency">Referencable:</label>
	  	<select name="OEfficiency" id="OEfficiency">
	    <option value="">Select a value</option>
	    <option value="one">1</option>
	    <option value="zero">0</option>
	    <option value="nOne">-1</option>
	    <option value="nTwo">None</option>
	  	</select>
	  	</li><br>

	  	<li>
	  	<label for="TAgenda:">Transformation Agenda:</label>
	  	<select name="TAgenda:" id="TAgenda:">
	    <option value="">Select a value</option>
	    <option value="one">1</option>
	    <option value="zero">0</option>
	    <option value="nOne">-1</option>
	    <option value="nTwo">None</option>
	  	</select>
	  	</li><br>

	  	<li>
	  	<label for="OEfficiency">Senior Sponsorship:</label>
	  	<select name="OEfficiency" id="OEfficiency">
	    <option value="">Select a value</option>
	    <option value="one">1</option>
	    <option value="zero">0</option>
	    <option value="nOne">-1</option>
	    <option value="nTwo">None</option>
	  	</select>
	  	</li><br>

	  	<li>
	  	<label for="OEfficiency">Relationships:</label>
	  	<select name="OEfficiency" id="OEfficiency">
	    <option value="">Select a value</option>
	    <option value="one">1</option>
	    <option value="zero">0</option>
	    <option value="nOne">-1</option>
	    <option value="nTwo">None</option>
	  	</select>
	  	</li><br>

	  	<li>
	  	<label for="OEfficiency">Partner Services:</label>
	  	<select name="OEfficiency" id="OEfficiency">
	    <option value="">Select a value</option>
	    <option value="one">1</option>
	    <option value="zero">0</option>
	    <option value="nOne">-1</option>
	    <option value="nTwo">None</option>
	  	</select>
	  	</li><br>


	</ul>






  	<li>
         <input type="submit" value="submit" />
         <input type="reset" value="reset" />
    </li>

  </form>
  
</body>
</html>
"""

class MyHandler(BaseHTTPServer.BaseHTTPRequestHandler):
	def do_GET(s):
  		s.send_response(200)
  		s.send_header("Content-type", "text/html")
  		s.end_headers()
  		s.wfile.write(index_page)

server_class = BaseHTTPServer.HTTPServer
httpd = server_class(("", 8020), MyHandler)
httpd.serve_forever()


def is_int(val):
	try:
		int(val)
		return True
	except ValueError:
		return False

prompts = ["Operational Efficiency: ",
	"Adoption Score: ",
	"Renewal Risk: ",
	"Referencable:",
	"Transformation Agenda: ",
	"Transformation Senior Sponsorship: ",
	"Transformation Senior Relationships: ",
	"Transformation Senior Partner Services: ",
	"Transformation Senior Health Status: "
	]

while len(a) < 8:
	# val = raw_input("Enter Operational Efficiency: ")
	# val = raw_input("Enter Adoption Score: ")
	# val = raw_input("Enter Renewal Risk: ")
	# val = raw_input("Enter Referenceable: ")
	# val = raw_input("Transformation Agenda: ")
	# val = raw_input("Transformation Senior Sponsorship: ")
	# val = raw_input("Transformation Senior Relationships: ")
	# val = raw_input("Transformation Senior Partner Services: ")
	# val = raw_input("Transformation Senior Health Status: ")

	val = raw_input(prompts[len(a)])

	if not val:
		continue
	if not is_int(val) or (int(val) < -2 or int(val) > 1):
		print 'Please enter an integer value between -2 and 1'
		continue
	a.append(int(val))





# Classify two new flower samples.
new_samples = np.array(
    [ a ], dtype=float)
y = classifier.predict(new_samples)
print ('Health Status: {}'.format(str(y)))



# Evaluate accuracy.
#accuracy_score = classifier.evaluate(x=x_test, y=y_test)["accuracy"]
#print('Accuracy: {0:f}'.format(accuracy_score)) 